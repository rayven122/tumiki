# Phase 3: Large Feature Migration

## Target Features

### 3.1 agents (26ファイル)

**tRPCルーター統合:**

```typescript
export const agentRouter = createTRPCRouter({
  // v2/agent
  list: ...,
  create: ...,
  update: ...,
  delete: ...,
  get: ...,
  // v2/agentExecution → サブルーター
  execution: createTRPCRouter({
    list: ...,
    get: ...,
    start: ...,
    stop: ...,
  }),
  // v2/agentSchedule → サブルーター
  schedule: createTRPCRouter({
    list: ...,
    create: ...,
    update: ...,
    delete: ...,
  }),
});
```

**移行対象:**

- [ ] `app/[orgSlug]/agents/_components/` → `features/agents/components/`
- [ ] `server/api/routers/v2/agent/` → `features/agents/api/`
- [ ] `server/api/routers/v2/agentExecution/` → `features/agents/api/execution/`
- [ ] `server/api/routers/v2/agentSchedule/` → `features/agents/api/schedule/`

### 3.2 mcps (76ファイル)

**tRPCルーター統合 (5→1):**

```typescript
export const mcpRouter = createTRPCRouter({
  // v2/userMcpServer
  list: ...,
  create: ...,
  update: ...,
  delete: ...,
  // サブルーター
  template: createTRPCRouter({
    list: ...,
    get: ...,
  }),
  auth: createTRPCRouter({
    generateApiKey: ...,
    deleteApiKey: ...,
    getOAuthConfig: ...,
  }),
  oauth: createTRPCRouter({
    getAuthorizationUrl: ...,
    handleCallback: ...,
    revokeToken: ...,
  }),
  requestLog: createTRPCRouter({
    list: ...,
    get: ...,
    getStats: ...,
  }),
});
```

**移行対象:**

- [ ] `app/[orgSlug]/mcps/_components/` → `features/mcps/components/`
- [ ] `server/api/routers/v2/userMcpServer/` → `features/mcps/api/`
- [ ] `server/api/routers/v2/mcpServerTemplate/` → `features/mcps/api/template/`
- [ ] `server/api/routers/v2/mcpServerAuth/` → `features/mcps/api/auth/`
- [ ] `server/api/routers/v2/oauth/` → `features/mcps/api/oauth/`
- [ ] `server/api/routers/v2/mcpRequestLog/` → `features/mcps/api/requestLog/`

## Completion Criteria

- [ ] All tRPC router tests pass
- [ ] Router key names maintained (backward compatible)
- [ ] EE/CE both build successfully
- [ ] Playwright MCP verification passes
