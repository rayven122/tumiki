---
allowed-tools: Bash, WebFetch, Read, Write, Edit, MultiEdit, TodoWrite, Grep, Glob
description: "tumikiリポジトリの週次進捗レポートを自動生成するコマンド"
---

rayven122/tumikiリポジトリの最新レポート生成日から現在までのプルリクエスト情報を解析し、プロジェクトオーナー向けの進捗レポートを自動生成します。

## 実行手順

1. **タスク管理の初期化**
   - TodoWriteツールでタスクリストを作成し、進捗を追跡

2. **最新レポートの日付確認**
   - `ls -t docs/weekly-reports/週次業務報告_*.md | head -1` で最新レポートファイルを特定
   - ファイル名から日付を抽出（YYYY年MM月DD日形式）
   - レポートが存在しない場合はデフォルトで過去7日間を使用

3. **GitHub情報の取得**
   - 最新レポート日付の翌日から現在までのPRを取得
   - `gh pr list --repo rayven122/tumiki --state closed --search "merged:>YYYY-MM-DD" --limit 100` 形式で実行
   - rayven122/tumikiリポジトリを対象とする

4. **PR情報の解析**
   - PRのタイトル、説明、マージ日時を収集
   - 機能追加、バグ修正、リファクタリングなどに分類
   - 重要度や影響範囲を判定

5. **進捗レポートの生成**
   - プロジェクトオーナー向けの要約を作成
   - 技術的詳細は省略し、ビジネス価値に焦点を当てる
   - 期間内の成果と今後の見通しを含める

6. **レポートファイルの作成**
   - MultiEditツールでMarkdown形式でレポートを生成
   - `/docs/weekly-report/` ディレクトリに日付を含むファイル名で保存
   - UTF-8エンコーディングを確実に使用

## 使用例

```bash
# レポート生成（最新レポート日付から現在まで）
/weekly-report

# 初回実行または特定期間を指定したい場合
/weekly-report --days 14
```

## パラメータ

- `--days`: 過去何日分のPRを確認するか（オプション、指定時は最新レポート日付を無視）

## レポート形式

### 日本語レポート例

```markdown
# 週次業務報告\_2025年7月7日

## 概要

今週は〇〇件のプルリクエストがマージされ、主に以下の進捗がありました。

## 今週の主な成果

### 🚀 新機能

- **MCPサーバー詳細ページの実装** (PR #99)
  - 各MCPサーバーの詳細情報を確認できるページを追加
  - リクエストログの可視化機能を実装
  - UIの改善により使いやすさが向上

### 🐛 バグ修正

- **認証エラーの修正** (PR #98)
  - ログイン時のセッション管理の問題を解決
  - ユーザビリティが改善されました

### 🔧 改善・リファクタリング

- **コンポーネントの整理** (PR #97)
  - Collapsibleコンポーネントを追加
  - コードの可読性が向上

## 数値サマリー

- マージされたPR: 5件
- 追加された機能: 3個
- 修正されたバグ: 2件
- 影響を受けたユーザー数: 推定100名

## 次週の展望

現在進行中のPRから、以下の機能が完成予定です：

- ダッシュボードの改善
- パフォーマンスの最適化

## 注目ポイント

- ユーザビリティの大幅な改善により、顧客満足度の向上が期待されます
- 新機能により、競合他社との差別化が進みました
```

## 自動判定ロジック

### PR分類の基準

- **新機能**: "feat:", "feature:", "add:" で始まるPR
- **バグ修正**: "fix:", "bug:", "hotfix:" で始まるPR
- **改善**: "improve:", "refactor:", "chore:" で始まるPR
- **ドキュメント**: "docs:", "doc:" で始まるPR

### 重要度の判定

- ファイル変更数とコード行数から影響範囲を推定
- PRの説明文から主要な変更点を抽出
- ラベルやマイルストーンから優先度を判定

## 出力フォーマット

```markdown
📊 週次レポートを生成中...

🔍 Step 1: GitHub情報の取得
✅ rayven122/tumiki から過去7日間のPRを取得

📝 Step 2: PR情報の解析
✅ 5件のマージ済みPRを分析完了

📄 Step 3: レポートの生成
✅ 週次業務報告\_2025年7月7日.md を作成完了

🎉 レポート生成が完了しました！

📋 レポートサマリー:

- 期間: 2025/07/01 - 2025/07/07
- マージされたPR: 5件
- 新機能: 3個
- バグ修正: 2件
- 保存先: ./docs/weekly-report/週次業務報告\_2025年7月7日.md
```

## 技術的な実装詳細

### GitHub CLI使用上の注意点

```bash
# 最新レポートファイルの取得
LATEST_REPORT=$(ls -t docs/weekly-reports/週次業務報告_*.md 2>/dev/null | head -1)

# ファイル名から日付を抽出（例: 2025年08月04日 → 2025-08-05）
if [ -n "$LATEST_REPORT" ]; then
  # ファイル名から日付部分を抽出し、次の日を計算
  REPORT_DATE=$(echo "$LATEST_REPORT" | sed -E 's/.*_([0-9]{4})年([0-9]{1,2})月([0-9]{1,2})日.*/\1-\2-\3/')
  START_DATE=$(date -j -f "%Y-%m-%d" -v +1d "$REPORT_DATE" +%Y-%m-%d)
else
  # レポートが存在しない場合は過去7日間
  START_DATE=$(date -v -7d +%Y-%m-%d)
fi

# 期間指定でPRを取得するコマンド
gh pr list --repo rayven122/tumiki --state closed --search "merged:>$START_DATE" --limit 100 --json number,title,mergedAt,author,body,labels,headRefName
```

### ファイル作成時の注意事項

- 既存ファイルが存在する場合はReadツールで読み取ってからWriteまたはMultiEditを使用
- 日本語ファイル名を使用する場合はUTF-8エンコーディングを確保
- `/docs/weekly-report/` ディレクトリに保存（`./docs/weekly-report/週次業務報告_YYYY年MM月DD日.md`）
- ディレクトリが存在しない場合は自動作成

### タスク管理の実装

- 各ステップをTodoWriteで管理し、進捗状況を明確化
- ステップ完了時に即座に`status: "completed"`に更新
- エラー発生時は該当タスクを`status: "in_progress"`のまま保持

## エラーハンドリング

### よくある問題と対処法

1. **jqの複雑なクエリエラー**
   - 単純なJSONフィルタに変更
   - 必要に応じて後処理でフィルタリング

2. **文字化け問題**
   - WriteツールまたはMultiEditツールを使用
   - UTF-8エンコーディングを明示的に指定

3. **GitHubのAPIレート制限**
   - 50件のlimitで十分な場合がほとんど
   - 必要に応じて複数回に分けて取得

4. **リポジトリアクセス権限エラー**
   - GitHub CLIの認証状態を確認
   - 公開リポジトリへのアクセスを確認

## 前提条件

- インターネット接続が必要
- GitHub CLIがインストールされ、認証済み
- GitHubの公開リポジトリまたはアクセス権限のあるリポジトリ
- macOS環境（`date -v`コマンド対応）

## 注意事項

- プライベートリポジトリの場合はGitHub CLIの認証が必要
- レポートは経営層向けに技術的詳細を省略しています
- 実際のビジネス影響は推定値です
- ファイル名に日本語を使用するため、システムのロケール設定を確認
