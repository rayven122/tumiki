# /fix-pr-review

PRのレビューコメントを確認して、指摘された問題を修正するコマンド

## 使用方法

```bash
/fix-pr-review
```

## 動作

1. 現在のブランチのPR情報を取得
2. PRのレビューコメント（特にClaude Code Reviewなどの自動レビュー）を確認
3. 重要度の高い問題から順に修正を実施
4. 修正内容をコミットしてPRにプッシュ

## 実行ステップ

### 1. PR情報とコメントの取得

```bash
# 現在のPRを確認
gh pr view --json number,title,state,url

# PRのコメントとレビューを取得
gh pr view [PR番号] --json comments,reviews
```

### 2. レビュー内容の分析

- 重要度8以上の問題を優先的に対処
- セキュリティ、メモリリーク、競合状態などの重要な問題を特定
- 具体的な改善案がある場合はそれを採用

### 3. 修正の実施

- 各問題に対して適切な修正を実施
- コードの品質基準を維持しながら修正
- 必要に応じてテストも更新

### 4. 検証とコミット

```bash
# フォーマットとテストの実行
pnpm format:fix
pnpm test
pnpm typecheck

# 変更をコミット
git add .
git commit -m "fix: PRレビューの指摘事項を修正"
git push
```

## 対象となるレビュータイプ

- **Claude Code Review**: 自動コードレビューボット
- **GitHub Actions**: CI/CDからの指摘
- **人間のレビュアー**: 手動でのコメント

## 優先順位

1. 🔴 **緊急（重要度8-10）**: セキュリティ、メモリリーク、データ破損の可能性
2. 🟡 **重要（重要度5-7）**: パフォーマンス、保守性、テストカバレッジ
3. 🟢 **軽微（重要度1-4）**: スタイル、ドキュメント、リファクタリング提案

## 注意事項

- レビューコメントの内容を正確に理解してから修正を実施
- 修正により既存の機能が壊れないよう注意
- 大きな変更の場合は、段階的にコミットを分ける
- 修正完了後は必ずテストを実行して動作確認

## サンプル出力

```text
📋 PRレビュー修正タスク:
✅ メモリリーク対策 - セッション接続マッピングのクリーンアップを追加
✅ 例外処理の改善 - クリーンアップ失敗時の状態管理を強化
✅ 競合状態の修正 - 原子的な状態更新を実装
✅ コードフォーマットとテストを実行
✅ 修正をコミットしてプッシュ

🎯 修正完了: 重要度8以上の問題を全て解決しました
```
