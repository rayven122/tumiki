# DB Schema
> Generated by [`prisma-markdown`](https://github.com/samchon/prisma-markdown)

- [McpServer](#mcpserver)
- [NextAuth](#nextauth)
- [Organization](#organization)
- [UserMcpServer](#usermcpserver)

## McpServer
```mermaid
erDiagram
"McpServer" {
  String id PK
  String name UK
  String iconPath "nullable"
  String command
  String args
  String envVars
  Boolean isPublic
  DateTime createdAt
  DateTime updatedAt
}
"Tool" {
  String id PK
  String name
  String description
  Json inputSchema
  Boolean isEnabled
  String mcpServerId FK
  DateTime createdAt
  DateTime updatedAt
}
"UserMcpServerConfig" {
  String id PK
  String name "nullable"
  String envVars
  String mcpServerId FK
  String userId FK
  String organizationId FK "nullable"
  DateTime createdAt
  DateTime updatedAt
}
"UserToolGroupTool" {
  String toolGroupId FK
  String toolId FK
  Int sortOrder
  DateTime createdAt
}
"UserToolGroup" {
  String id PK
  String name
  String description
  Boolean isEnabled
  String userId FK
  String organizationId FK "nullable"
  DateTime createdAt
  DateTime updatedAt
}
"UserMcpServerInstance" {
  String id PK
  String name
  String description
  String iconPath "nullable"
  ServerStatus serverStatus
  ServerType serverType
  String toolGroupId FK,UK
  String userId FK
  String organizationId FK "nullable"
  DateTime createdAt
  DateTime updatedAt
}
"_ToolToUserMcpServerConfig" {
  String A FK
  String B FK
}
"_UserMcpServerConfigToUserMcpServerInstance" {
  String A FK
  String B FK
}
"UserMcpServerInstanceToolGroup" {
  String mcpServerInstanceId FK
  String toolGroupId FK
  Int sortOrder
  DateTime createdAt
}
"Tool" }o--|| "McpServer" : mcpServer
"UserMcpServerConfig" }o--|| "McpServer" : mcpServer
"UserToolGroupTool" }o--|| "UserToolGroup" : toolGroup
"UserToolGroupTool" }o--|| "Tool" : tool
"UserMcpServerInstance" |o--|| "UserToolGroup" : toolGroup
"_ToolToUserMcpServerConfig" }o--|| "Tool" : Tool
"_ToolToUserMcpServerConfig" }o--|| "UserMcpServerConfig" : UserMcpServerConfig
"_UserMcpServerConfigToUserMcpServerInstance" }o--|| "UserMcpServerConfig" : UserMcpServerConfig
"_UserMcpServerConfigToUserMcpServerInstance" }o--|| "UserMcpServerInstance" : UserMcpServerInstance
"UserMcpServerInstanceToolGroup" }o--|| "UserMcpServerInstance" : mcpServerInstance
"UserMcpServerInstanceToolGroup" }o--|| "UserToolGroup" : toolGroup
```

### `McpServer`
MCP サーバー (github や notion などの接続する外部 MCP サーバー)

**Properties**
  - `id`: 
  - `name`: MCP サーバー名
  - `iconPath`: アイコンパス
  - `command`: コマンド
  - `args`: 引数
  - `envVars`: 環境変数
  - `isPublic`: サーバーが公開されているか
  - `createdAt`: 
  - `updatedAt`: 

### `Tool`
MCP サーバーのツール一覧

**Properties**
  - `id`: 
  - `name`: ツールの名前
  - `description`: ツールの説明
  - `inputSchema`: ツールの入力スキーマ（JSON Schema形式）
  - `isEnabled`: ツールを有効にするか
  - `mcpServerId`: 
  - `createdAt`: 
  - `updatedAt`: 

### `UserMcpServerConfig`
ユーザーが利用できるMCPサーバーの設定

**Properties**
  - `id`: 
  - `name`: MCPサーバー名 (ユーザーが設定した名前)
  - `envVars`: MCPサーバーの envVars を文字配列を key にしたオブジェクトを Object.stringify + 暗号化したもの
  - `mcpServerId`: MCPサーバーID
  - `userId`: ユーザーID
  - `organizationId`: 組織
  - `createdAt`: 
  - `updatedAt`: 

### `UserToolGroupTool`
ToolGroup, Toolの関連を表す中間テーブル

**Properties**
  - `toolGroupId`: ToolGroupへの参照
  - `toolId`: Toolへの参照
  - `sortOrder`: ソート順序
  - `createdAt`: 

### `UserToolGroup`
どのツール群を利用するかを設定する

**Properties**
  - `id`: 
  - `name`: ツールグループ名
  - `description`: ツールグループの説明
  - `isEnabled`: ツールグループが有効かどうか
  - `userId`: ユーザーID
  - `organizationId`: 組織
  - `createdAt`: 
  - `updatedAt`: 

### `UserMcpServerInstance`
MCPサーバーとして利用するインスタンス

**Properties**
  - `id`: 
  - `name`: 稼働中のMCPサーバー名
  - `description`: サーバーの説明
  - `iconPath`: アイコンパス
  - `serverStatus`: サーバーの状態
  - `serverType`: サーバーの種類
  - `toolGroupId`
    > ツールグループ
    > UserMcpServerInstance ごとに1つの ToolGroup が存在する 1:1 関係
  - `userId`: ユーザーID
  - `organizationId`: 組織
  - `createdAt`: 
  - `updatedAt`: 

### `_ToolToUserMcpServerConfig`
Pair relationship table between [Tool](#Tool) and [UserMcpServerConfig](#UserMcpServerConfig)

**Properties**
  - `A`: 
  - `B`: 

### `_UserMcpServerConfigToUserMcpServerInstance`
Pair relationship table between [UserMcpServerConfig](#UserMcpServerConfig) and [UserMcpServerInstance](#UserMcpServerInstance)

**Properties**
  - `A`: 
  - `B`: 

### `UserMcpServerInstanceToolGroup`
MCPサーバーインスタンスとツールグループの関連を管理する中間テーブル

**Properties**
  - `mcpServerInstanceId`: 
  - `toolGroupId`: 
  - `sortOrder`: このMcpServerInstance内でのToolGroupの表示順序
  - `createdAt`: 


## NextAuth
```mermaid
erDiagram
"Account" {
  String id PK
  String userId FK
  String type
  String provider
  String providerAccountId
  String refresh_token "nullable"
  String access_token "nullable"
  Int expires_at "nullable"
  String token_type "nullable"
  String scope "nullable"
  String id_token "nullable"
  String session_state "nullable"
  Int refresh_token_expires_in "nullable"
}
"Session" {
  String id PK
  String sessionToken UK
  String userId FK
  DateTime expires
}
"User" {
  String id PK
  String name "nullable"
  String email UK "nullable"
  DateTime emailVerified "nullable"
  String image "nullable"
  Role role
}
"VerificationToken" {
  String identifier
  String token UK
  DateTime expires
}
"Account" }o--|| "User" : user
"Session" }o--|| "User" : user
```

### `Account`

**Properties**
  - `id`: 
  - `userId`: 
  - `type`: 認証プロバイダーの種類（oauth, oidc, email, credentials）
  - `provider`: 認証プロバイダー名（google, github, etc.）
  - `providerAccountId`: プロバイダー側のアカウントID
  - `refresh_token`: リフレッシュトークン
  - `access_token`: アクセストークン
  - `expires_at`: トークンの有効期限（Unixタイムスタンプ）
  - `token_type`: トークンの種類
  - `scope`: 認可スコープ
  - `id_token`: IDトークン
  - `session_state`: セッション状態
  - `refresh_token_expires_in`: リフレッシュトークンの有効期限（秒）

### `Session`

**Properties**
  - `id`: 
  - `sessionToken`: セッショントークン
  - `userId`: 
  - `expires`: セッションの有効期限

### `User`

**Properties**
  - `id`: 
  - `name`: ユーザー名
  - `email`: メールアドレス
  - `emailVerified`: メールアドレスの検証日時
  - `image`: プロフィール画像のURL
  - `role`: ユーザーの権限

### `VerificationToken`

**Properties**
  - `identifier`: 検証対象の識別子（メールアドレスなど）
  - `token`: 検証トークン
  - `expires`: トークンの有効期限


## Organization
```mermaid
erDiagram
"Organization" {
  String id PK
  String name
  String description "nullable"
  String logoUrl "nullable"
  Boolean isDeleted
  String createdBy FK
  DateTime createdAt
  DateTime updatedAt
}
"OrganizationMember" {
  String id PK
  String organizationId FK
  String userId FK
  Boolean isAdmin
  DateTime createdAt
  DateTime updatedAt
}
"OrganizationInvitation" {
  String id PK
  String organizationId FK
  String email
  String token UK
  String invitedBy FK
  Boolean isAdmin
  String roleIds
  String groupIds
  DateTime expires
  DateTime createdAt
  DateTime updatedAt
}
"OrganizationGroup" {
  String id PK
  String name
  String description "nullable"
  String organizationId FK
  DateTime createdAt
  DateTime updatedAt
}
"OrganizationRole" {
  String id PK
  String name
  String description "nullable"
  String organizationId FK
  Boolean isDefault
  DateTime createdAt
  DateTime updatedAt
}
"RolePermission" {
  String id PK
  String roleId FK
  ResourceType resourceType
  PermissionAction action
  DateTime createdAt
  DateTime updatedAt
}
"ResourceAccessControl" {
  String id PK
  String organizationId FK
  ResourceType resourceType
  String resourceId
  String memberId FK "nullable"
  String groupId FK "nullable"
  PermissionAction allowedActions
  PermissionAction deniedActions
  DateTime createdAt
  DateTime updatedAt
}
"_OrganizationMemberToOrganizationRole" {
  String A FK
  String B FK
}
"_OrganizationGroupToOrganizationMember" {
  String A FK
  String B FK
}
"_OrganizationGroupToOrganizationRole" {
  String A FK
  String B FK
}
"OrganizationMember" }o--|| "Organization" : organization
"OrganizationInvitation" }o--|| "Organization" : organization
"OrganizationGroup" }o--|| "Organization" : organization
"OrganizationRole" }o--|| "Organization" : organization
"RolePermission" }o--|| "OrganizationRole" : role
"ResourceAccessControl" }o--|| "Organization" : organization
"ResourceAccessControl" }o--o| "OrganizationMember" : member
"ResourceAccessControl" }o--o| "OrganizationGroup" : group
"_OrganizationMemberToOrganizationRole" }o--|| "OrganizationMember" : OrganizationMember
"_OrganizationMemberToOrganizationRole" }o--|| "OrganizationRole" : OrganizationRole
"_OrganizationGroupToOrganizationMember" }o--|| "OrganizationGroup" : OrganizationGroup
"_OrganizationGroupToOrganizationMember" }o--|| "OrganizationMember" : OrganizationMember
"_OrganizationGroupToOrganizationRole" }o--|| "OrganizationGroup" : OrganizationGroup
"_OrganizationGroupToOrganizationRole" }o--|| "OrganizationRole" : OrganizationRole
```

### `Organization`

**Properties**
  - `id`: 
  - `name`: 組織名
  - `description`: 組織の説明
  - `logoUrl`: 組織のロゴURL
  - `isDeleted`: 論理削除フラグ
  - `createdBy`: 組織の作成者
  - `createdAt`: 
  - `updatedAt`: 

### `OrganizationMember`

**Properties**
  - `id`: 
  - `organizationId`: 
  - `userId`: 
  - `isAdmin`: このメンバーが管理者権限を持つか
  - `createdAt`: 
  - `updatedAt`: 

### `OrganizationInvitation`

**Properties**
  - `id`: 
  - `organizationId`: 
  - `email`: 招待先メールアドレス
  - `token`: 招待トークン
  - `invitedBy`: 招待者のユーザーID
  - `isAdmin`: 招待された人が管理者になるか
  - `roleIds`: 付与される予定のロールID配列
  - `groupIds`: 招待時に追加するグループID配列
  - `expires`: 招待の有効期限
  - `createdAt`: 
  - `updatedAt`: 

### `OrganizationGroup`

**Properties**
  - `id`: 
  - `name`: グループ名
  - `description`: グループの説明
  - `organizationId`: 組織ID
  - `createdAt`: 
  - `updatedAt`: 

### `OrganizationRole`
ロール定義

**Properties**
  - `id`: 
  - `name`: ロール名
  - `description`: ロールの説明
  - `organizationId`: 組織ID
  - `isDefault`: デフォルトロールか
  - `createdAt`: 
  - `updatedAt`: 

### `RolePermission`
ロールに付与された権限

**Properties**
  - `id`: 
  - `roleId`: ロールID
  - `resourceType`: リソースタイプ
  - `action`: 権限アクション
  - `createdAt`: 
  - `updatedAt`: 

### `ResourceAccessControl`
特定リソースへのアクセス制御

**Properties**
  - `id`: 
  - `organizationId`: 組織ID
  - `resourceType`: リソースタイプ
  - `resourceId`: リソースID
  - `memberId`: 対象メンバー（nullの場合はグループまたはすべてのメンバー）
  - `groupId`: 対象グループ（nullの場合はメンバー個人またはすべてのメンバー）
  - `allowedActions`: 許可されたアクション
  - `deniedActions`: 拒否されたアクション　(※許可よりも拒否が優先される)
  - `createdAt`: 
  - `updatedAt`: 

### `_OrganizationMemberToOrganizationRole`
Pair relationship table between [OrganizationMember](#OrganizationMember) and [OrganizationRole](#OrganizationRole)

**Properties**
  - `A`: 
  - `B`: 

### `_OrganizationGroupToOrganizationMember`
Pair relationship table between [OrganizationGroup](#OrganizationGroup) and [OrganizationMember](#OrganizationMember)

**Properties**
  - `A`: 
  - `B`: 

### `_OrganizationGroupToOrganizationRole`
Pair relationship table between [OrganizationGroup](#OrganizationGroup) and [OrganizationRole](#OrganizationRole)

**Properties**
  - `A`: 
  - `B`: 


## UserMcpServer
```mermaid
erDiagram
"UserMcpServerInstanceToolGroup" {
  String mcpServerInstanceId FK
  String toolGroupId FK
  Int sortOrder
  DateTime createdAt
}
"User" {
  String id PK
  String name "nullable"
  String email UK "nullable"
  DateTime emailVerified "nullable"
  String image "nullable"
  Role role
}
"UserMcpServerConfig" {
  String id PK
  String name "nullable"
  String envVars
  String mcpServerId FK
  String userId FK
  String organizationId FK "nullable"
  DateTime createdAt
  DateTime updatedAt
}
"UserToolGroupTool" {
  String toolGroupId FK
  String toolId FK
  Int sortOrder
  DateTime createdAt
}
"UserToolGroup" {
  String id PK
  String name
  String description
  Boolean isEnabled
  String userId FK
  String organizationId FK "nullable"
  DateTime createdAt
  DateTime updatedAt
}
"UserMcpServerInstance" {
  String id PK
  String name
  String description
  String iconPath "nullable"
  ServerStatus serverStatus
  ServerType serverType
  String toolGroupId FK,UK
  String userId FK
  String organizationId FK "nullable"
  DateTime createdAt
  DateTime updatedAt
}
"_ToolToUserMcpServerConfig" {
  String A FK
  String B FK
}
"_UserMcpServerConfigToUserMcpServerInstance" {
  String A FK
  String B FK
}
"UserMcpServerInstanceToolGroup" }o--|| "UserMcpServerInstance" : mcpServerInstance
"UserMcpServerInstanceToolGroup" }o--|| "UserToolGroup" : toolGroup
"UserMcpServerConfig" }o--|| "User" : user
"UserToolGroupTool" }o--|| "UserToolGroup" : toolGroup
"UserToolGroup" }o--|| "User" : user
"UserMcpServerInstance" |o--|| "UserToolGroup" : toolGroup
"UserMcpServerInstance" }o--|| "User" : user
"_ToolToUserMcpServerConfig" }o--|| "UserMcpServerConfig" : UserMcpServerConfig
"_UserMcpServerConfigToUserMcpServerInstance" }o--|| "UserMcpServerConfig" : UserMcpServerConfig
"_UserMcpServerConfigToUserMcpServerInstance" }o--|| "UserMcpServerInstance" : UserMcpServerInstance
```

### `UserMcpServerInstanceToolGroup`
MCPサーバーインスタンスとツールグループの関連を管理する中間テーブル

**Properties**
  - `mcpServerInstanceId`: 
  - `toolGroupId`: 
  - `sortOrder`: このMcpServerInstance内でのToolGroupの表示順序
  - `createdAt`: 

### `User`

**Properties**
  - `id`: 
  - `name`: ユーザー名
  - `email`: メールアドレス
  - `emailVerified`: メールアドレスの検証日時
  - `image`: プロフィール画像のURL
  - `role`: ユーザーの権限

### `UserMcpServerConfig`
ユーザーが利用できるMCPサーバーの設定

**Properties**
  - `id`: 
  - `name`: MCPサーバー名 (ユーザーが設定した名前)
  - `envVars`: MCPサーバーの envVars を文字配列を key にしたオブジェクトを Object.stringify + 暗号化したもの
  - `mcpServerId`: MCPサーバーID
  - `userId`: ユーザーID
  - `organizationId`: 組織
  - `createdAt`: 
  - `updatedAt`: 

### `UserToolGroupTool`
ToolGroup, Toolの関連を表す中間テーブル

**Properties**
  - `toolGroupId`: ToolGroupへの参照
  - `toolId`: Toolへの参照
  - `sortOrder`: ソート順序
  - `createdAt`: 

### `UserToolGroup`
どのツール群を利用するかを設定する

**Properties**
  - `id`: 
  - `name`: ツールグループ名
  - `description`: ツールグループの説明
  - `isEnabled`: ツールグループが有効かどうか
  - `userId`: ユーザーID
  - `organizationId`: 組織
  - `createdAt`: 
  - `updatedAt`: 

### `UserMcpServerInstance`
MCPサーバーとして利用するインスタンス

**Properties**
  - `id`: 
  - `name`: 稼働中のMCPサーバー名
  - `description`: サーバーの説明
  - `iconPath`: アイコンパス
  - `serverStatus`: サーバーの状態
  - `serverType`: サーバーの種類
  - `toolGroupId`
    > ツールグループ
    > UserMcpServerInstance ごとに1つの ToolGroup が存在する 1:1 関係
  - `userId`: ユーザーID
  - `organizationId`: 組織
  - `createdAt`: 
  - `updatedAt`: 

### `_ToolToUserMcpServerConfig`
Pair relationship table between [Tool](#Tool) and [UserMcpServerConfig](#UserMcpServerConfig)

**Properties**
  - `A`: 
  - `B`: 

### `_UserMcpServerConfigToUserMcpServerInstance`
Pair relationship table between [UserMcpServerConfig](#UserMcpServerConfig) and [UserMcpServerInstance](#UserMcpServerInstance)

**Properties**
  - `A`: 
  - `B`: 