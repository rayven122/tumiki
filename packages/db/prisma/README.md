# DB Schema

> Generated by [`prisma-markdown`](https://github.com/samchon/prisma-markdown)

- [ApiKey](#apikey)
- [Auth](#auth)
- [McpServer](#mcpserver)
- [Organization](#organization)
- [UserMcpServer](#usermcpserver)
- [Chat](#chat)
- [default](#default)

## ApiKey

```mermaid
erDiagram
"McpApiKey" {
  String id PK
  String name
  String apiKey UK
  String apiKeyHash UK "nullable"
  Boolean isActive
  DateTime lastUsedAt "nullable"
  DateTime expiresAt "nullable"
  String userMcpServerInstanceId FK
  String userId FK
  DateTime createdAt
  DateTime updatedAt
}
```

### `McpApiKey`

APIã‚­ãƒ¼ç®¡ç†ãƒ†ãƒ¼ãƒ–ãƒ«

**Properties**

- `id`:
- `name`: APIã‚­ãƒ¼åï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¨­å®šï¼‰
- `apiKey`: æš—å·åŒ–ã•ã‚ŒãŸAPIã‚­ãƒ¼ï¼ˆå…±é€šéµæš—å·åŒ–ï¼‰
- `apiKeyHash`: APIã‚­ãƒ¼ã®ãƒãƒƒã‚·ãƒ¥å€¤ï¼ˆæ¤œç´¢ç”¨ï¼‰
- `isActive`: APIã‚­ãƒ¼ãŒæœ‰åŠ¹ã‹ã©ã†ã‹
- `lastUsedAt`: æœ€å¾Œã«ä½¿ç”¨ã•ã‚ŒãŸæ—¥æ™‚
- `expiresAt`: APIã‚­ãƒ¼ã®æœ‰åŠ¹æœŸé™
- `userMcpServerInstanceId`: é–¢é€£ã™ã‚‹UserMcpServerInstanceã®ID
- `userId`: ä½œæˆè€…ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
- `createdAt`:
- `updatedAt`:

## Auth

```mermaid
erDiagram
"User" {
  String id PK
  String name "nullable"
  String email UK "nullable"
  String image "nullable"
  Role role
  Boolean hasCompletedOnboarding
  DateTime createdAt
  DateTime updatedAt
}
```

### `User`

**Properties**

- `id`: Auth0ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID (sub) - ä¸»ã‚­ãƒ¼ã¨ã—ã¦ä½¿ç”¨
- `name`: ãƒ¦ãƒ¼ã‚¶ãƒ¼å
- `email`: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
- `image`: ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒã®URL
- `role`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¨©é™
- `hasCompletedOnboarding`: ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å®Œäº†ãƒ•ãƒ©ã‚°
- `createdAt`:
- `updatedAt`:

## McpServer

```mermaid
erDiagram
"McpServer" {
  String id PK
  String name
  String iconPath "nullable"
  TransportType transportType
  String command "nullable"
  String args
  String url "nullable"
  String envVars
  AuthType authType
  String(50) oauthProvider "nullable"
  String oauthScopes
  ServerType serverType
  String createdBy FK "nullable"
  McpServerVisibility visibility
  String organizationId FK "nullable"
  Boolean isPublic
  DateTime createdAt
  DateTime updatedAt
}
"Tool" {
  String id PK
  String name
  String description
  Json inputSchema
  Boolean isEnabled
  String mcpServerId FK
  DateTime createdAt
  DateTime updatedAt
}
"UserMcpServerConfig" {
  String id PK
  String name
  String description
  String envVars
  String oauthConnection "nullable"
  String oauthScopes
  String mcpServerId FK
  String userId FK
  String organizationId FK "nullable"
  DateTime createdAt
  DateTime updatedAt
}
"UserToolGroupTool" {
  String userMcpServerConfigId FK
  String toolGroupId FK
  String toolId FK
  Int sortOrder
  DateTime createdAt
}
"UserToolGroup" {
  String id PK
  String name
  String description
  Boolean isEnabled
  String userId FK
  String organizationId FK "nullable"
  DateTime createdAt
  DateTime updatedAt
}
"UserMcpServerInstance" {
  String id PK
  String name
  String description
  String iconPath "nullable"
  ServerStatus serverStatus
  ServerType serverType
  String toolGroupId FK,UK
  String userId FK
  String organizationId FK "nullable"
  Int displayOrder
  DateTime createdAt
  DateTime updatedAt
  DateTime deletedAt "nullable"
}
"McpServerRequestLog" {
  String id PK
  String userId FK "nullable"
  String mcpServerInstanceId FK
  String toolName
  TransportType transportType
  String method
  String responseStatus
  Int durationMs
  String errorMessage "nullable"
  String errorCode "nullable"
  Int inputBytes "nullable"
  Int outputBytes "nullable"
  String organizationId FK "nullable"
  String userAgent "nullable"
  DateTime createdAt
}
"McpServerRequestData" {
  String id PK
  String requestLogId FK,UK
  Bytes inputDataCompressed
  Bytes outputDataCompressed
  Int originalInputSize
  Int originalOutputSize
  Int compressedInputSize
  Int compressedOutputSize
  Float compressionRatio
  DateTime createdAt
}
"_ToolToUserMcpServerConfig" {
  String A FK
  String B FK
}
"UserMcpServerInstanceToolGroup" {
  String mcpServerInstanceId FK
  String toolGroupId FK
  Int sortOrder
  DateTime createdAt
}
"Tool" }o--|| "McpServer" : mcpServer
"UserMcpServerConfig" }o--|| "McpServer" : mcpServer
"UserToolGroupTool" }o--|| "UserMcpServerConfig" : userMcpServerConfig
"UserToolGroupTool" }o--|| "UserToolGroup" : toolGroup
"UserToolGroupTool" }o--|| "Tool" : tool
"UserMcpServerInstance" |o--|| "UserToolGroup" : toolGroup
"McpServerRequestLog" }o--|| "UserMcpServerInstance" : mcpServerInstance
"McpServerRequestData" |o--|| "McpServerRequestLog" : requestLog
"_ToolToUserMcpServerConfig" }o--|| "Tool" : Tool
"_ToolToUserMcpServerConfig" }o--|| "UserMcpServerConfig" : UserMcpServerConfig
"UserMcpServerInstanceToolGroup" }o--|| "UserMcpServerInstance" : mcpServerInstance
"UserMcpServerInstanceToolGroup" }o--|| "UserToolGroup" : toolGroup
```

### `McpServer`

MCP ã‚µãƒ¼ãƒãƒ¼ (github ã‚„ notion ãªã©ã®æ¥ç¶šã™ã‚‹å¤–éƒ¨ MCP ã‚µãƒ¼ãƒãƒ¼)
transportType ã«å¿œã˜ã¦æ¥ç¶šæ–¹å¼ã‚’é¸æŠ

**Properties**

- `id`:
- `name`: MCP ã‚µãƒ¼ãƒãƒ¼å
- `iconPath`: ã‚¢ã‚¤ã‚³ãƒ³ãƒ‘ã‚¹
- `transportType`: æ¥ç¶šã‚¿ã‚¤ãƒ—ï¼ˆstdio, sseï¼‰
- `command`: STDIOç”¨ã®ã‚³ãƒãƒ³ãƒ‰
- `args`: STDIOç”¨ã®å¼•æ•°
- `url`: SSE/Streamable HTTPSæ¥ç¶šç”¨ã®URL
- `envVars`
  > STDIO: ç’°å¢ƒå¤‰æ•°ã®ã‚­ãƒ¼é…åˆ—ï¼ˆå€¤ã¯UserMcpServerConfigã§ç®¡ç†ï¼‰
  > SSE/Streamable HTTPS: ãƒ˜ãƒƒãƒ€ãƒ¼ã®ã‚­ãƒ¼é…åˆ—ï¼ˆå€¤ã¯UserMcpServerConfigã§ç®¡ç†ï¼‰
- `authType`: èªè¨¼ã‚¿ã‚¤ãƒ—
- `oauthProvider`
  > OAuth ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ï¼ˆAuthTypeãŒOAUTHã®å ´åˆã®ã¿å¿…é ˆï¼‰
  > google, github, slack, notion, linkedin ãªã©
- `oauthScopes`: OAuth ã§å¿…è¦ãªãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¹ã‚³ãƒ¼ãƒ—
- `serverType`: ã‚µãƒ¼ãƒãƒ¼ã®ç¨®é¡ï¼ˆå…¬å¼/ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚«ã‚¹ã‚¿ãƒ ï¼‰
- `createdBy`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚«ã‚¹ã‚¿ãƒ ã‚µãƒ¼ãƒãƒ¼ã®ä½œæˆè€…
- `visibility`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚«ã‚¹ã‚¿ãƒ ã‚µãƒ¼ãƒãƒ¼ã®å¯è¦–æ€§
- `organizationId`: çµ„ç¹”é™å®šå…¬é–‹æ™‚ã®æ‰€å±çµ„ç¹”ID
- `isPublic`: ã‚µãƒ¼ãƒãƒ¼ãŒå…¬é–‹ã•ã‚Œã¦ã„ã‚‹ã‹ï¼ˆãƒ¬ã‚¬ã‚·ãƒ¼ï¼‰
- `createdAt`:
- `updatedAt`:

### `Tool`

MCP ã‚µãƒ¼ãƒãƒ¼ã®ãƒ„ãƒ¼ãƒ«ä¸€è¦§

**Properties**

- `id`:
- `name`: ãƒ„ãƒ¼ãƒ«ã®åå‰
- `description`: ãƒ„ãƒ¼ãƒ«ã®èª¬æ˜
- `inputSchema`: ãƒ„ãƒ¼ãƒ«ã®å…¥åŠ›ã‚¹ã‚­ãƒ¼ãƒï¼ˆJSON Schemaå½¢å¼ï¼‰
- `isEnabled`: ãƒ„ãƒ¼ãƒ«ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã‹
- `mcpServerId`:
- `createdAt`:
- `updatedAt`:

### `UserMcpServerConfig`

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåˆ©ç”¨ã§ãã‚‹MCPã‚µãƒ¼ãƒãƒ¼ã®è¨­å®š

**Properties**

- `id`:
- `name`: è¨­å®šåï¼ˆä¾‹ï¼šã€Œé–‹ç™ºç”¨ã€ã€Œæœ¬ç•ªç”¨ã€ã€Œãƒ†ã‚¹ãƒˆç”¨ã€ï¼‰
- `description`: è¨­å®šã®èª¬æ˜
- `envVars`: MCPã‚µãƒ¼ãƒãƒ¼ã® envVars ã‚’æ–‡å­—é…åˆ—ã‚’ key ã«ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ Object.stringify + æš—å·åŒ–ã—ãŸã‚‚ã®
- `oauthConnection`: OAuthæ¥ç¶šã®Auth0 connectionåï¼ˆuser-specificï¼‰
- `oauthScopes`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé¸æŠã—ãŸè¿½åŠ ã‚¹ã‚³ãƒ¼ãƒ—
- `mcpServerId`: MCPã‚µãƒ¼ãƒãƒ¼ID
- `userId`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
- `organizationId`: çµ„ç¹”
- `createdAt`:
- `updatedAt`:

### `UserToolGroupTool`

ToolGroup, Toolã®é–¢é€£ã‚’è¡¨ã™ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«

**Properties**

- `userMcpServerConfigId`: UserMcpServerConfig ã¸ã®å‚ç…§
- `toolGroupId`: ToolGroupã¸ã®å‚ç…§
- `toolId`: Toolã¸ã®å‚ç…§
- `sortOrder`: ã‚½ãƒ¼ãƒˆé †åº
- `createdAt`:

### `UserToolGroup`

ã©ã®ãƒ„ãƒ¼ãƒ«ç¾¤ã‚’åˆ©ç”¨ã™ã‚‹ã‹ã‚’è¨­å®šã™ã‚‹
tool group å†…ã«ã€åŒä¸€ã® mcpServer ã®è¨­å®šå…¥ã‚Œã‚‰ã‚Œãªã„ğŸ¤”

**Properties**

- `id`:
- `name`: ãƒ„ãƒ¼ãƒ«ã‚°ãƒ«ãƒ¼ãƒ—å
- `description`: ãƒ„ãƒ¼ãƒ«ã‚°ãƒ«ãƒ¼ãƒ—ã®èª¬æ˜
- `isEnabled`: ãƒ„ãƒ¼ãƒ«ã‚°ãƒ«ãƒ¼ãƒ—ãŒæœ‰åŠ¹ã‹ã©ã†ã‹
- `userId`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
- `organizationId`: çµ„ç¹”
- `createdAt`:
- `updatedAt`:

### `UserMcpServerInstance`

MCPã‚µãƒ¼ãƒãƒ¼ã¨ã—ã¦åˆ©ç”¨ã™ã‚‹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹

**Properties**

- `id`:
- `name`: ç¨¼åƒä¸­ã®MCPã‚µãƒ¼ãƒãƒ¼å
- `description`: ã‚µãƒ¼ãƒãƒ¼ã®èª¬æ˜
- `iconPath`: ã‚¢ã‚¤ã‚³ãƒ³ãƒ‘ã‚¹
- `serverStatus`: ã‚µãƒ¼ãƒãƒ¼ã®çŠ¶æ…‹
- `serverType`: ã‚µãƒ¼ãƒãƒ¼ã®ç¨®é¡
- `toolGroupId`
  > ãƒ„ãƒ¼ãƒ«ã‚°ãƒ«ãƒ¼ãƒ—
  > UserMcpServerInstance ã”ã¨ã«1ã¤ã® ToolGroup ãŒå­˜åœ¨ã™ã‚‹ 1:1 é–¢ä¿‚
- `userId`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
- `organizationId`: çµ„ç¹”
- `displayOrder`: è¡¨ç¤ºé †åºï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ï¼‰
- `createdAt`:
- `updatedAt`:
- `deletedAt`: è«–ç†å‰Šé™¤ç”¨ã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—

### `McpServerRequestLog`

MCPã‚µãƒ¼ãƒãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ­ã‚°

**Properties**

- `id`:
- `userId`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ID (OAuth2 èªè¨¼ã‚‚ã—ãã¯ã€api key ã«å¿œã˜ã¦ã€åˆ©ç”¨ãƒ¦ãƒ¼ã‚¶ã‚’ç‰¹å®šã™ã‚‹)
- `mcpServerInstanceId`: MCPã‚µãƒ¼ãƒãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ID
- `toolName`: å®Ÿè¡Œã•ã‚ŒãŸãƒ„ãƒ¼ãƒ«å
- `transportType`: ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã®ãƒˆãƒ©ãƒ³ã‚¹ãƒãƒ¼ãƒˆã‚¿ã‚¤ãƒ—ï¼ˆSSE, STREAMABLE_HTTPS ã®ã©ã¡ã‚‰ã‹ï¼‰
- `method`: MCPãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆtools/list, tools/callï¼‰
- `responseStatus`: HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰
- `durationMs`: å®Ÿè¡Œæ™‚é–“ï¼ˆãƒŸãƒªç§’ï¼‰
- `errorMessage`: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆã‚¨ãƒ©ãƒ¼ç¨®åˆ¥ã®ã¿ï¼‰
- `errorCode`: ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰
- `inputBytes`: å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚ºï¼ˆLLMã‹ã‚‰MCPã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ã®ãƒã‚¤ãƒˆæ•°ï¼‰
- `outputBytes`: å‡ºåŠ›ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚ºï¼ˆMCPã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰LLMã«è¿”ã™ãƒ‡ãƒ¼ã‚¿ã®ãƒã‚¤ãƒˆæ•°ï¼‰
- `organizationId`: çµ„ç¹”ID
- `userAgent`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
- `createdAt`:

### `McpServerRequestData`

MCPã‚µãƒ¼ãƒãƒ¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®è©³ç´°ãƒ‡ãƒ¼ã‚¿ï¼ˆåˆ†æç”¨ï¼‰
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯è¡¨ç¤ºã•ã‚Œãªã„å†…éƒ¨ãƒ‡ãƒ¼ã‚¿

**Properties**

- `id`:
- `requestLogId`: é–¢é€£ã™ã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ­ã‚°IDï¼ˆ1:1é–¢ä¿‚ï¼‰
- `inputDataCompressed`: ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ç”Ÿãƒ‡ãƒ¼ã‚¿ï¼ˆJSONæ–‡å­—åˆ—ã€gzipåœ§ç¸®æ¸ˆã¿ï¼‰
- `outputDataCompressed`: ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ç”Ÿãƒ‡ãƒ¼ã‚¿ï¼ˆJSONæ–‡å­—åˆ—ã€gzipåœ§ç¸®æ¸ˆã¿ï¼‰
- `originalInputSize`: åœ§ç¸®å‰ã®å…ƒãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º
- `originalOutputSize`:
- `compressedInputSize`: åœ§ç¸®å¾Œã®ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º
- `compressedOutputSize`:
- `compressionRatio`: åœ§ç¸®ç‡ï¼ˆ0.0-1.0ã€å°ã•ã„ã»ã©é«˜åœ§ç¸®ï¼‰
- `createdAt`:

### `_ToolToUserMcpServerConfig`

Pair relationship table between [Tool](#Tool) and [UserMcpServerConfig](#UserMcpServerConfig)

**Properties**

- `A`:
- `B`:

### `UserMcpServerInstanceToolGroup`

MCPã‚µãƒ¼ãƒãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¨ãƒ„ãƒ¼ãƒ«ã‚°ãƒ«ãƒ¼ãƒ—ã®é–¢é€£ã‚’ç®¡ç†ã™ã‚‹ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«

**Properties**

- `mcpServerInstanceId`:
- `toolGroupId`:
- `sortOrder`: ã“ã®McpServerInstanceå†…ã§ã®ToolGroupã®è¡¨ç¤ºé †åº
- `createdAt`:

## Organization

```mermaid
erDiagram
"Organization" {
  String id PK
  String name
  String description "nullable"
  String logoUrl "nullable"
  Boolean isDeleted
  String createdBy FK
  DateTime createdAt
  DateTime updatedAt
}
"OrganizationMember" {
  String id PK
  String organizationId FK
  String userId FK
  Boolean isAdmin
  DateTime createdAt
  DateTime updatedAt
}
"OrganizationInvitation" {
  String id PK
  String organizationId FK
  String email
  String token UK
  String invitedBy FK
  Boolean isAdmin
  String roleIds
  String groupIds
  DateTime expires
  DateTime createdAt
  DateTime updatedAt
}
"OrganizationGroup" {
  String id PK
  String name
  String description "nullable"
  String organizationId FK
  DateTime createdAt
  DateTime updatedAt
}
"OrganizationRole" {
  String id PK
  String name
  String description "nullable"
  String organizationId FK
  Boolean isDefault
  DateTime createdAt
  DateTime updatedAt
}
"RolePermission" {
  String id PK
  String roleId FK
  ResourceType resourceType
  PermissionAction action
  DateTime createdAt
  DateTime updatedAt
}
"ResourceAccessControl" {
  String id PK
  String organizationId FK
  ResourceType resourceType
  String resourceId
  String memberId FK "nullable"
  String groupId FK "nullable"
  PermissionAction allowedActions
  PermissionAction deniedActions
  DateTime createdAt
  DateTime updatedAt
}
"_OrganizationMemberToOrganizationRole" {
  String A FK
  String B FK
}
"_OrganizationGroupToOrganizationMember" {
  String A FK
  String B FK
}
"_OrganizationGroupToOrganizationRole" {
  String A FK
  String B FK
}
"OrganizationMember" }o--|| "Organization" : organization
"OrganizationInvitation" }o--|| "Organization" : organization
"OrganizationGroup" }o--|| "Organization" : organization
"OrganizationRole" }o--|| "Organization" : organization
"RolePermission" }o--|| "OrganizationRole" : role
"ResourceAccessControl" }o--|| "Organization" : organization
"ResourceAccessControl" }o--o| "OrganizationMember" : member
"ResourceAccessControl" }o--o| "OrganizationGroup" : group
"_OrganizationMemberToOrganizationRole" }o--|| "OrganizationMember" : OrganizationMember
"_OrganizationMemberToOrganizationRole" }o--|| "OrganizationRole" : OrganizationRole
"_OrganizationGroupToOrganizationMember" }o--|| "OrganizationGroup" : OrganizationGroup
"_OrganizationGroupToOrganizationMember" }o--|| "OrganizationMember" : OrganizationMember
"_OrganizationGroupToOrganizationRole" }o--|| "OrganizationGroup" : OrganizationGroup
"_OrganizationGroupToOrganizationRole" }o--|| "OrganizationRole" : OrganizationRole
```

### `Organization`

**Properties**

- `id`:
- `name`: çµ„ç¹”å
- `description`: çµ„ç¹”ã®èª¬æ˜
- `logoUrl`: çµ„ç¹”ã®ãƒ­ã‚´URL
- `isDeleted`: è«–ç†å‰Šé™¤ãƒ•ãƒ©ã‚°
- `createdBy`: çµ„ç¹”ã®ä½œæˆè€…
- `createdAt`:
- `updatedAt`:

### `OrganizationMember`

**Properties**

- `id`:
- `organizationId`:
- `userId`:
- `isAdmin`: ã“ã®ãƒ¡ãƒ³ãƒãƒ¼ãŒç®¡ç†è€…æ¨©é™ã‚’æŒã¤ã‹
- `createdAt`:
- `updatedAt`:

### `OrganizationInvitation`

**Properties**

- `id`:
- `organizationId`:
- `email`: æ‹›å¾…å…ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
- `token`: æ‹›å¾…ãƒˆãƒ¼ã‚¯ãƒ³
- `invitedBy`: æ‹›å¾…è€…ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
- `isAdmin`: æ‹›å¾…ã•ã‚ŒãŸäººãŒç®¡ç†è€…ã«ãªã‚‹ã‹
- `roleIds`: ä»˜ä¸ã•ã‚Œã‚‹äºˆå®šã®ãƒ­ãƒ¼ãƒ«IDé…åˆ—
- `groupIds`: æ‹›å¾…æ™‚ã«è¿½åŠ ã™ã‚‹ã‚°ãƒ«ãƒ¼ãƒ—IDé…åˆ—
- `expires`: æ‹›å¾…ã®æœ‰åŠ¹æœŸé™
- `createdAt`:
- `updatedAt`:

### `OrganizationGroup`

**Properties**

- `id`:
- `name`: ã‚°ãƒ«ãƒ¼ãƒ—å
- `description`: ã‚°ãƒ«ãƒ¼ãƒ—ã®èª¬æ˜
- `organizationId`: çµ„ç¹”ID
- `createdAt`:
- `updatedAt`:

### `OrganizationRole`

ãƒ­ãƒ¼ãƒ«å®šç¾©

**Properties**

- `id`:
- `name`: ãƒ­ãƒ¼ãƒ«å
- `description`: ãƒ­ãƒ¼ãƒ«ã®èª¬æ˜
- `organizationId`: çµ„ç¹”ID
- `isDefault`: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ­ãƒ¼ãƒ«ã‹
- `createdAt`:
- `updatedAt`:

### `RolePermission`

ãƒ­ãƒ¼ãƒ«ã«ä»˜ä¸ã•ã‚ŒãŸæ¨©é™

**Properties**

- `id`:
- `roleId`: ãƒ­ãƒ¼ãƒ«ID
- `resourceType`: ãƒªã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—
- `action`: æ¨©é™ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
- `createdAt`:
- `updatedAt`:

### `ResourceAccessControl`

ç‰¹å®šãƒªã‚½ãƒ¼ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡

**Properties**

- `id`:
- `organizationId`: çµ„ç¹”ID
- `resourceType`: ãƒªã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—
- `resourceId`: ãƒªã‚½ãƒ¼ã‚¹ID
- `memberId`: å¯¾è±¡ãƒ¡ãƒ³ãƒãƒ¼ï¼ˆnullã®å ´åˆã¯ã‚°ãƒ«ãƒ¼ãƒ—ã¾ãŸã¯ã™ã¹ã¦ã®ãƒ¡ãƒ³ãƒãƒ¼ï¼‰
- `groupId`: å¯¾è±¡ã‚°ãƒ«ãƒ¼ãƒ—ï¼ˆnullã®å ´åˆã¯ãƒ¡ãƒ³ãƒãƒ¼å€‹äººã¾ãŸã¯ã™ã¹ã¦ã®ãƒ¡ãƒ³ãƒãƒ¼ï¼‰
- `allowedActions`: è¨±å¯ã•ã‚ŒãŸã‚¢ã‚¯ã‚·ãƒ§ãƒ³
- `deniedActions`: æ‹’å¦ã•ã‚ŒãŸã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€€(â€»è¨±å¯ã‚ˆã‚Šã‚‚æ‹’å¦ãŒå„ªå…ˆã•ã‚Œã‚‹)
- `createdAt`:
- `updatedAt`:

### `_OrganizationMemberToOrganizationRole`

Pair relationship table between [OrganizationMember](#OrganizationMember) and [OrganizationRole](#OrganizationRole)

**Properties**

- `A`:
- `B`:

### `_OrganizationGroupToOrganizationMember`

Pair relationship table between [OrganizationGroup](#OrganizationGroup) and [OrganizationMember](#OrganizationMember)

**Properties**

- `A`:
- `B`:

### `_OrganizationGroupToOrganizationRole`

Pair relationship table between [OrganizationGroup](#OrganizationGroup) and [OrganizationRole](#OrganizationRole)

**Properties**

- `A`:
- `B`:

## UserMcpServer

```mermaid
erDiagram
"UserMcpServerInstanceToolGroup" {
  String mcpServerInstanceId FK
  String toolGroupId FK
  Int sortOrder
  DateTime createdAt
}
"User" {
  String id PK
  String name "nullable"
  String email UK "nullable"
  String image "nullable"
  Role role
  Boolean hasCompletedOnboarding
  DateTime createdAt
  DateTime updatedAt
}
"UserMcpServerConfig" {
  String id PK
  String name
  String description
  String envVars
  String oauthConnection "nullable"
  String oauthScopes
  String mcpServerId FK
  String userId FK
  String organizationId FK "nullable"
  DateTime createdAt
  DateTime updatedAt
}
"UserToolGroupTool" {
  String userMcpServerConfigId FK
  String toolGroupId FK
  String toolId FK
  Int sortOrder
  DateTime createdAt
}
"UserToolGroup" {
  String id PK
  String name
  String description
  Boolean isEnabled
  String userId FK
  String organizationId FK "nullable"
  DateTime createdAt
  DateTime updatedAt
}
"UserMcpServerInstance" {
  String id PK
  String name
  String description
  String iconPath "nullable"
  ServerStatus serverStatus
  ServerType serverType
  String toolGroupId FK,UK
  String userId FK
  String organizationId FK "nullable"
  Int displayOrder
  DateTime createdAt
  DateTime updatedAt
  DateTime deletedAt "nullable"
}
"McpServerRequestLog" {
  String id PK
  String userId FK "nullable"
  String mcpServerInstanceId FK
  String toolName
  TransportType transportType
  String method
  String responseStatus
  Int durationMs
  String errorMessage "nullable"
  String errorCode "nullable"
  Int inputBytes "nullable"
  Int outputBytes "nullable"
  String organizationId FK "nullable"
  String userAgent "nullable"
  DateTime createdAt
}
"McpServerRequestData" {
  String id PK
  String requestLogId FK,UK
  Bytes inputDataCompressed
  Bytes outputDataCompressed
  Int originalInputSize
  Int originalOutputSize
  Int compressedInputSize
  Int compressedOutputSize
  Float compressionRatio
  DateTime createdAt
}
"_ToolToUserMcpServerConfig" {
  String A FK
  String B FK
}
"UserMcpServerInstanceToolGroup" }o--|| "UserMcpServerInstance" : mcpServerInstance
"UserMcpServerInstanceToolGroup" }o--|| "UserToolGroup" : toolGroup
"UserMcpServerConfig" }o--|| "User" : user
"UserToolGroupTool" }o--|| "UserMcpServerConfig" : userMcpServerConfig
"UserToolGroupTool" }o--|| "UserToolGroup" : toolGroup
"UserToolGroup" }o--|| "User" : user
"UserMcpServerInstance" |o--|| "UserToolGroup" : toolGroup
"UserMcpServerInstance" }o--|| "User" : user
"McpServerRequestLog" }o--o| "User" : user
"McpServerRequestLog" }o--|| "UserMcpServerInstance" : mcpServerInstance
"McpServerRequestData" |o--|| "McpServerRequestLog" : requestLog
"_ToolToUserMcpServerConfig" }o--|| "UserMcpServerConfig" : UserMcpServerConfig
```

### `UserMcpServerInstanceToolGroup`

MCPã‚µãƒ¼ãƒãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¨ãƒ„ãƒ¼ãƒ«ã‚°ãƒ«ãƒ¼ãƒ—ã®é–¢é€£ã‚’ç®¡ç†ã™ã‚‹ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«

**Properties**

- `mcpServerInstanceId`:
- `toolGroupId`:
- `sortOrder`: ã“ã®McpServerInstanceå†…ã§ã®ToolGroupã®è¡¨ç¤ºé †åº
- `createdAt`:

### `User`

**Properties**

- `id`: Auth0ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID (sub) - ä¸»ã‚­ãƒ¼ã¨ã—ã¦ä½¿ç”¨
- `name`: ãƒ¦ãƒ¼ã‚¶ãƒ¼å
- `email`: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
- `image`: ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒã®URL
- `role`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¨©é™
- `hasCompletedOnboarding`: ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å®Œäº†ãƒ•ãƒ©ã‚°
- `createdAt`:
- `updatedAt`:

### `UserMcpServerConfig`

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåˆ©ç”¨ã§ãã‚‹MCPã‚µãƒ¼ãƒãƒ¼ã®è¨­å®š

**Properties**

- `id`:
- `name`: è¨­å®šåï¼ˆä¾‹ï¼šã€Œé–‹ç™ºç”¨ã€ã€Œæœ¬ç•ªç”¨ã€ã€Œãƒ†ã‚¹ãƒˆç”¨ã€ï¼‰
- `description`: è¨­å®šã®èª¬æ˜
- `envVars`: MCPã‚µãƒ¼ãƒãƒ¼ã® envVars ã‚’æ–‡å­—é…åˆ—ã‚’ key ã«ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ Object.stringify + æš—å·åŒ–ã—ãŸã‚‚ã®
- `oauthConnection`: OAuthæ¥ç¶šã®Auth0 connectionåï¼ˆuser-specificï¼‰
- `oauthScopes`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé¸æŠã—ãŸè¿½åŠ ã‚¹ã‚³ãƒ¼ãƒ—
- `mcpServerId`: MCPã‚µãƒ¼ãƒãƒ¼ID
- `userId`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
- `organizationId`: çµ„ç¹”
- `createdAt`:
- `updatedAt`:

### `UserToolGroupTool`

ToolGroup, Toolã®é–¢é€£ã‚’è¡¨ã™ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«

**Properties**

- `userMcpServerConfigId`: UserMcpServerConfig ã¸ã®å‚ç…§
- `toolGroupId`: ToolGroupã¸ã®å‚ç…§
- `toolId`: Toolã¸ã®å‚ç…§
- `sortOrder`: ã‚½ãƒ¼ãƒˆé †åº
- `createdAt`:

### `UserToolGroup`

ã©ã®ãƒ„ãƒ¼ãƒ«ç¾¤ã‚’åˆ©ç”¨ã™ã‚‹ã‹ã‚’è¨­å®šã™ã‚‹
tool group å†…ã«ã€åŒä¸€ã® mcpServer ã®è¨­å®šå…¥ã‚Œã‚‰ã‚Œãªã„ğŸ¤”

**Properties**

- `id`:
- `name`: ãƒ„ãƒ¼ãƒ«ã‚°ãƒ«ãƒ¼ãƒ—å
- `description`: ãƒ„ãƒ¼ãƒ«ã‚°ãƒ«ãƒ¼ãƒ—ã®èª¬æ˜
- `isEnabled`: ãƒ„ãƒ¼ãƒ«ã‚°ãƒ«ãƒ¼ãƒ—ãŒæœ‰åŠ¹ã‹ã©ã†ã‹
- `userId`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
- `organizationId`: çµ„ç¹”
- `createdAt`:
- `updatedAt`:

### `UserMcpServerInstance`

MCPã‚µãƒ¼ãƒãƒ¼ã¨ã—ã¦åˆ©ç”¨ã™ã‚‹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹

**Properties**

- `id`:
- `name`: ç¨¼åƒä¸­ã®MCPã‚µãƒ¼ãƒãƒ¼å
- `description`: ã‚µãƒ¼ãƒãƒ¼ã®èª¬æ˜
- `iconPath`: ã‚¢ã‚¤ã‚³ãƒ³ãƒ‘ã‚¹
- `serverStatus`: ã‚µãƒ¼ãƒãƒ¼ã®çŠ¶æ…‹
- `serverType`: ã‚µãƒ¼ãƒãƒ¼ã®ç¨®é¡
- `toolGroupId`
  > ãƒ„ãƒ¼ãƒ«ã‚°ãƒ«ãƒ¼ãƒ—
  > UserMcpServerInstance ã”ã¨ã«1ã¤ã® ToolGroup ãŒå­˜åœ¨ã™ã‚‹ 1:1 é–¢ä¿‚
- `userId`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
- `organizationId`: çµ„ç¹”
- `displayOrder`: è¡¨ç¤ºé †åºï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ï¼‰
- `createdAt`:
- `updatedAt`:
- `deletedAt`: è«–ç†å‰Šé™¤ç”¨ã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—

### `McpServerRequestLog`

MCPã‚µãƒ¼ãƒãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ­ã‚°

**Properties**

- `id`:
- `userId`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ID (OAuth2 èªè¨¼ã‚‚ã—ãã¯ã€api key ã«å¿œã˜ã¦ã€åˆ©ç”¨ãƒ¦ãƒ¼ã‚¶ã‚’ç‰¹å®šã™ã‚‹)
- `mcpServerInstanceId`: MCPã‚µãƒ¼ãƒãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ID
- `toolName`: å®Ÿè¡Œã•ã‚ŒãŸãƒ„ãƒ¼ãƒ«å
- `transportType`: ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã®ãƒˆãƒ©ãƒ³ã‚¹ãƒãƒ¼ãƒˆã‚¿ã‚¤ãƒ—ï¼ˆSSE, STREAMABLE_HTTPS ã®ã©ã¡ã‚‰ã‹ï¼‰
- `method`: MCPãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆtools/list, tools/callï¼‰
- `responseStatus`: HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰
- `durationMs`: å®Ÿè¡Œæ™‚é–“ï¼ˆãƒŸãƒªç§’ï¼‰
- `errorMessage`: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆã‚¨ãƒ©ãƒ¼ç¨®åˆ¥ã®ã¿ï¼‰
- `errorCode`: ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰
- `inputBytes`: å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚ºï¼ˆLLMã‹ã‚‰MCPã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ã®ãƒã‚¤ãƒˆæ•°ï¼‰
- `outputBytes`: å‡ºåŠ›ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚ºï¼ˆMCPã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰LLMã«è¿”ã™ãƒ‡ãƒ¼ã‚¿ã®ãƒã‚¤ãƒˆæ•°ï¼‰
- `organizationId`: çµ„ç¹”ID
- `userAgent`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
- `createdAt`:

### `McpServerRequestData`

MCPã‚µãƒ¼ãƒãƒ¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®è©³ç´°ãƒ‡ãƒ¼ã‚¿ï¼ˆåˆ†æç”¨ï¼‰
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯è¡¨ç¤ºã•ã‚Œãªã„å†…éƒ¨ãƒ‡ãƒ¼ã‚¿

**Properties**

- `id`:
- `requestLogId`: é–¢é€£ã™ã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ­ã‚°IDï¼ˆ1:1é–¢ä¿‚ï¼‰
- `inputDataCompressed`: ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ç”Ÿãƒ‡ãƒ¼ã‚¿ï¼ˆJSONæ–‡å­—åˆ—ã€gzipåœ§ç¸®æ¸ˆã¿ï¼‰
- `outputDataCompressed`: ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ç”Ÿãƒ‡ãƒ¼ã‚¿ï¼ˆJSONæ–‡å­—åˆ—ã€gzipåœ§ç¸®æ¸ˆã¿ï¼‰
- `originalInputSize`: åœ§ç¸®å‰ã®å…ƒãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º
- `originalOutputSize`:
- `compressedInputSize`: åœ§ç¸®å¾Œã®ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º
- `compressedOutputSize`:
- `compressionRatio`: åœ§ç¸®ç‡ï¼ˆ0.0-1.0ã€å°ã•ã„ã»ã©é«˜åœ§ç¸®ï¼‰
- `createdAt`:

### `_ToolToUserMcpServerConfig`

Pair relationship table between [Tool](#Tool) and [UserMcpServerConfig](#UserMcpServerConfig)

**Properties**

- `A`:
- `B`:

## Chat

```mermaid
erDiagram
"User" {
  String id PK
  String name "nullable"
  String email UK "nullable"
  String image "nullable"
  Role role
  Boolean hasCompletedOnboarding
  DateTime createdAt
  DateTime updatedAt
}
```

### `User`

**Properties**

- `id`: Auth0ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID (sub) - ä¸»ã‚­ãƒ¼ã¨ã—ã¦ä½¿ç”¨
- `name`: ãƒ¦ãƒ¼ã‚¶ãƒ¼å
- `email`: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
- `image`: ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒã®URL
- `role`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¨©é™
- `hasCompletedOnboarding`: ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å®Œäº†ãƒ•ãƒ©ã‚°
- `createdAt`:
- `updatedAt`:

## default

```mermaid
erDiagram
"Chat" {
  String id PK
  DateTime createdAt
  String title
  String userId FK
  Visibility visibility
}
"Message" {
  String id PK
  String chatId FK
  String role
  Json parts
  Json attachments
  DateTime createdAt
}
"Vote" {
  String chatId FK
  String messageId FK
  Boolean isUpvoted
}
"Document" {
  String id
  DateTime createdAt
  String title
  String content "nullable"
  DocumentKind kind
  String userId FK
}
"Suggestion" {
  String id PK
  String documentId FK
  DateTime documentCreatedAt
  String originalText
  String suggestedText
  String description "nullable"
  Boolean isResolved
  String userId FK
  DateTime createdAt
}
"Stream" {
  String id PK
  String chatId FK
  DateTime createdAt
}
"waiting_list" {
  String id PK
  String email UK
  String name "nullable"
  String company "nullable"
  String useCase "nullable"
  DateTime createdAt
}
"Message" }o--|| "Chat" : chat
"Vote" }o--|| "Chat" : chat
"Vote" }o--|| "Message" : message
"Suggestion" }o--|| "Document" : document
"Stream" }o--|| "Chat" : chat
```

### `Chat`

**Properties**

- `id`:
- `createdAt`:
- `title`:
- `userId`:
- `visibility`:

### `Message`

**Properties**

- `id`:
- `chatId`:
- `role`:
- `parts`:
- `attachments`:
- `createdAt`:

### `Vote`

**Properties**

- `chatId`:
- `messageId`:
- `isUpvoted`:

### `Document`

**Properties**

- `id`:
- `createdAt`:
- `title`:
- `content`:
- `kind`:
- `userId`:

### `Suggestion`

**Properties**

- `id`:
- `documentId`:
- `documentCreatedAt`:
- `originalText`:
- `suggestedText`:
- `description`:
- `isResolved`:
- `userId`:
- `createdAt`:

### `Stream`

**Properties**

- `id`:
- `chatId`:
- `createdAt`:

### `waiting_list`

**Properties**

- `id`:
- `email`:
- `name`:
- `company`:
- `useCase`:
- `createdAt`:
