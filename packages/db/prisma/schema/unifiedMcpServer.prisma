/**
 * @namespace UnifiedMcpServer
 * 統合MCPサーバー関連のスキーマ
 *
 * 複数のMCPサーバーを単一エンドポイントで公開するための設定。
 * ユーザーが事前に登録した複数のMCPサーバーを統合して利用可能にする。
 */

/// 統合MCPサーバー設定
/// ユーザーが複数のMCPサーバーを1つのエンドポイントで利用するための設定
/// @namespace UnifiedMcpServer
model UnifiedMcpServer {
  /// レコードID（cuid: 25文字）
  id             String   @id @default(cuid())
  /// 統合サーバー名（表示名、重複許可）
  name           String
  /// 統合サーバーの説明（オプショナル）
  description    String?

  /// 所属組織のID
  organizationId String
  /// 所属組織への参照
  organization   Organization @relation(fields: [organizationId], references: [id])

  /// 作成者のユーザーID（このユーザーのみがアクセス可能）
  createdBy      String
  /// 作成者への参照
  creator        User     @relation(fields: [createdBy], references: [id])

  /// 子サーバー（統合対象のMCPサーバー）一覧
  childServers   UnifiedMcpServerChild[]

  /// 論理削除用のタイムスタンプ
  deletedAt      DateTime?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([organizationId])
  @@index([createdBy])
  @@index([deletedAt])
}

/// 統合MCPサーバーの子サーバー（中間テーブル）
/// UnifiedMcpServerとMcpServerの明示的多対多リレーション
/// @namespace UnifiedMcpServer
model UnifiedMcpServerChild {
  /// レコードID（cuid: 25文字）
  id                  String   @id @default(cuid())

  /// 親の統合MCPサーバーID
  unifiedMcpServerId  String
  /// 親の統合MCPサーバーへの参照（親削除時にカスケード削除）
  unifiedMcpServer    UnifiedMcpServer @relation(fields: [unifiedMcpServerId], references: [id], onDelete: Cascade)

  /// 子のMCPサーバーID
  mcpServerId         String
  /// 子のMCPサーバーへの参照（サーバー削除時にカスケード削除）
  mcpServer           McpServer @relation(fields: [mcpServerId], references: [id], onDelete: Cascade)

  /// 表示順序（ツール一覧での並び順）
  displayOrder        Int @default(0)

  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  /// 同一統合サーバー内で同じMCPサーバーは1回のみ
  @@unique([unifiedMcpServerId, mcpServerId])
  @@index([mcpServerId])
}
