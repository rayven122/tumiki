/**
 * @namespace ApiKey
 * APIキー認証システム用のテーブル
 */

/// APIキー管理テーブル
/// @namespace ApiKey
model McpApiKey {
  id                      String                @id @default(cuid())
  /// APIキー名（ユーザーが設定）
  name                    String
  /// 暗号化されたAPIキー（client_id として使用）
  apiKey                  String                @unique /// @encrypted
  /// APIキーの検索用ハッシュ（SHA-256、prisma-field-encryptionにより自動生成）
  apiKeyHash              String?               @unique /// @encryption:hash(apiKey)
  /// APIキーが有効かどうか
  isActive                Boolean               @default(true)
  /// 最後に使用された日時
  lastUsedAt              DateTime?
  /// APIキーの有効期限
  expiresAt               DateTime?
  /// スコープ情報（例: ["mcp:access:notion", "mcp:access:figma"]）
  scopes                  String[]              @default([])
  /// 関連するユーザー
  userId                  String
  user                    User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  /// 関連するUserMcpServerInstanceのID
  userMcpServerInstanceId String
  userMcpServerInstance   UserMcpServerInstance @relation(fields: [userMcpServerInstanceId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([userMcpServerInstanceId])
  @@index([apiKeyHash])
}
