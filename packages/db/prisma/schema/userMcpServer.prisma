/**
 * @namespace McpServer
 * @namespace UserMcpServer
 * ãƒ¦ãƒ¼ã‚¶ã”ã¨ã«ä½œæˆã™ã‚‹ãŸã‚ã€ä»–ã®ãƒ¦ãƒ¼ã‚¶ã«ã¯è¡¨ç¤ºã•ã‚Œãªã„
 */

/// ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåˆ©ç”¨ã§ãã‚‹MCPã‚µãƒ¼ãƒãƒ¼ã®è¨­å®š
/// @namespace McpServer
/// @namespace UserMcpServer
model UserMcpServerConfig {
  id                 String              @id @default(cuid())
  /// è¨­å®šåï¼ˆä¾‹ï¼šã€Œé–‹ç™ºç”¨ã€ã€Œæœ¬ç•ªç”¨ã€ã€Œãƒ†ã‚¹ãƒˆç”¨ã€ï¼‰
  name               String
  /// è¨­å®šã®èª¬æ˜
  description        String
  /// MCPã‚µãƒ¼ãƒãƒ¼ã® envVars ã‚’æ–‡å­—é…åˆ—ã‚’ key ã«ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ Object.stringify + æš—å·åŒ–ã—ãŸã‚‚ã®
  envVars            String /// @encrypted
  /// åˆ©ç”¨å¯èƒ½ãªãƒ„ãƒ¼ãƒ«ã‚°ãƒ«ãƒ¼ãƒ—
  tools              Tool[]
  /// UserMcpServerConfig ã¨ ToolGroup ã®é–¢é€£ã‚’ç®¡ç†ã™ã‚‹ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«
  userToolGroupTools UserToolGroupTool[]
  /// MCPã‚µãƒ¼ãƒãƒ¼ID
  mcpServerId        String
  mcpServer          McpServer           @relation(fields: [mcpServerId], references: [id], onDelete: Cascade)
  /// ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
  userId             String
  user               User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  /// çµ„ç¹”
  organizationId     String?
  organization       Organization?       @relation(fields: [organizationId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  /// åŒä¸€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ»åŒä¸€ã‚µãƒ¼ãƒãƒ¼ã§è¨­å®šåãŒé‡è¤‡ã—ãªã„ã‚ˆã†ã«ã™ã‚‹
  @@unique([userId, mcpServerId, name])
}

/// ToolGroup, Toolã®é–¢é€£ã‚’è¡¨ã™ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«
/// @namespace McpServer
/// @namespace UserMcpServer
model UserToolGroupTool {
  /// UserMcpServerConfig ã¸ã®å‚ç…§
  userMcpServerConfigId String
  userMcpServerConfig   UserMcpServerConfig @relation(fields: [userMcpServerConfigId], references: [id], onDelete: Cascade)
  /// ToolGroupã¸ã®å‚ç…§
  toolGroupId           String
  toolGroup             UserToolGroup       @relation(fields: [toolGroupId], references: [id], onDelete: Cascade)
  /// Toolã¸ã®å‚ç…§
  toolId                String
  tool                  Tool                @relation(fields: [toolId], references: [id], onDelete: Cascade)

  /// ã‚½ãƒ¼ãƒˆé †åº
  sortOrder Int @default(0)

  createdAt DateTime @default(now())

  @@id([toolGroupId, userMcpServerConfigId, toolId])
}

/// ã©ã®ãƒ„ãƒ¼ãƒ«ç¾¤ã‚’åˆ©ç”¨ã™ã‚‹ã‹ã‚’è¨­å®šã™ã‚‹
/// tool group å†…ã«ã€åŒä¸€ã® mcpServer ã®è¨­å®šå…¥ã‚Œã‚‰ã‚Œãªã„ğŸ¤”
/// @namespace McpServer
/// @namespace UserMcpServer
model UserToolGroup {
  id                          String                           @id @default(cuid())
  /// ãƒ„ãƒ¼ãƒ«ã‚°ãƒ«ãƒ¼ãƒ—å
  /// @zod.string.min(1)
  name                        String
  /// ãƒ„ãƒ¼ãƒ«ã‚°ãƒ«ãƒ¼ãƒ—ã®èª¬æ˜
  description                 String
  /// ãƒ„ãƒ¼ãƒ«ã‚°ãƒ«ãƒ¼ãƒ—ãŒæœ‰åŠ¹ã‹ã©ã†ã‹
  isEnabled                   Boolean                          @default(true)
  /// UserMcpServerInstance ã”ã¨ã«1ã¤ã® ToolGroup ãŒå­˜åœ¨ã™ã‚‹
  mcpServerInstance           UserMcpServerInstance?
  /// ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
  userId                      String
  user                        User                             @relation(fields: [userId], references: [id], onDelete: Cascade)
  /// ToolGroupã«å«ã¾ã‚Œã‚‹Toolï¼ˆä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«çµŒç”±ï¼‰
  toolGroupTools              UserToolGroupTool[]
  /// çµ„ç¹”
  organizationId              String?
  organization                Organization?                    @relation(fields: [organizationId], references: [id])
  /// MCPã‚µãƒ¼ãƒãƒ¼ã¨ãƒ„ãƒ¼ãƒ«ã‚°ãƒ«ãƒ¼ãƒ—ã®é–¢é€£ã‚’ç®¡ç†ã™ã‚‹ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«
  mcpServerInstanceToolGroups UserMcpServerInstanceToolGroup[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

/// MCPã‚µãƒ¼ãƒãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¨ãƒ„ãƒ¼ãƒ«ã‚°ãƒ«ãƒ¼ãƒ—ã®é–¢é€£ã‚’ç®¡ç†ã™ã‚‹ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«
/// @namespace UserMcpServer
/// @namespace McpServer
model UserMcpServerInstanceToolGroup {
  mcpServerInstanceId String
  mcpServerInstance   UserMcpServerInstance @relation(fields: [mcpServerInstanceId], references: [id], onDelete: Cascade)
  toolGroupId         String
  toolGroup           UserToolGroup         @relation(fields: [toolGroupId], references: [id], onDelete: Cascade)
  /// ã“ã®McpServerInstanceå†…ã§ã®ToolGroupã®è¡¨ç¤ºé †åº
  sortOrder           Int                   @default(0)

  createdAt DateTime @default(now())

  @@id([mcpServerInstanceId, toolGroupId])
}

/// ã‚µãƒ¼ãƒãƒ¼ã®çŠ¶æ…‹
/// @namespace UserMcpServer
/// @namespace McpServer
enum ServerStatus {
  /// ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹
  RUNNING
  /// ã‚µãƒ¼ãƒãƒ¼ãŒåœæ­¢ã—ã¦ã„ã‚‹
  STOPPED
  /// ã‚µãƒ¼ãƒãƒ¼ãŒã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã„ã‚‹
  ERROR
}

/// ã‚µãƒ¼ãƒãƒ¼ã®ç¨®é¡
/// @namespace UserMcpServer
/// @namespace McpServer
enum ServerType {
  /// ã‚«ã‚¹ã‚¿ãƒ MCPã‚µãƒ¼ãƒãƒ¼
  CUSTOM
  /// å…¬å¼MCPã‚µãƒ¼ãƒãƒ¼
  OFFICIAL
}

/// MCPã‚µãƒ¼ãƒãƒ¼ã¨ã—ã¦åˆ©ç”¨ã™ã‚‹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
/// @namespace McpServer
/// @namespace UserMcpServer
model UserMcpServerInstance {
  id                          String                           @id @default(cuid())
  /// ç¨¼åƒä¸­ã®MCPã‚µãƒ¼ãƒãƒ¼å
  /// @zod.string.min(1)
  name                        String
  /// ã‚µãƒ¼ãƒãƒ¼ã®èª¬æ˜
  description                 String
  /// ã‚¢ã‚¤ã‚³ãƒ³ãƒ‘ã‚¹
  iconPath                    String?
  /// ã‚µãƒ¼ãƒãƒ¼ã®çŠ¶æ…‹
  serverStatus                ServerStatus
  /// ã‚µãƒ¼ãƒãƒ¼ã®ç¨®é¡
  serverType                  ServerType
  /// MCPã‚µãƒ¼ãƒãƒ¼ã¨ãƒ„ãƒ¼ãƒ«ã‚°ãƒ«ãƒ¼ãƒ—ã®é–¢é€£ã‚’ç®¡ç†ã™ã‚‹ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«
  mcpServerInstanceToolGroups UserMcpServerInstanceToolGroup[]
  /// ãƒ„ãƒ¼ãƒ«ã‚°ãƒ«ãƒ¼ãƒ—
  /// UserMcpServerInstance ã”ã¨ã«1ã¤ã® ToolGroup ãŒå­˜åœ¨ã™ã‚‹ 1:1 é–¢ä¿‚
  toolGroupId                 String                           @unique
  toolGroup                   UserToolGroup                    @relation(fields: [toolGroupId], references: [id])
  /// APIã‚­ãƒ¼ä¸€è¦§
  apiKeys                     McpApiKey[]
  /// ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
  userId                      String
  user                        User                             @relation(fields: [userId], references: [id])
  /// çµ„ç¹”
  organizationId              String?
  organization                Organization?                    @relation(fields: [organizationId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
