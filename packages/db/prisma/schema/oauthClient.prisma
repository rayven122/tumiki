/**
 * @namespace TumikiOAuth
 * Tumiki MCP Proxy への Keycloak OAuth 2.1 認証関連のテーブル定義
 * AI クライアントが MCP Proxy に接続する際の認証に使用
 *
 * Keycloak Integration:
 * - トークン発行・失効: Keycloak が担当
 * - トークン検証: MCP Proxy が担当（Keycloak JWKS使用）
 * - CLIENT_SECRET: Keycloak が管理（このテーブルには保存しない）
 *
 * 注意: このスキーマは既存の OAuthClient (Backend MCP サーバー用) とは別のものです
 */

/// Tumiki OAuth Client - AI クライアントが MCP Proxy に接続するための認証情報
/// Keycloak Client との対応付けを管理
/// @namespace TumikiOAuth
model TumikiOAuthClient {
  id                String   @id @default(cuid())
  keycloakClientId  String   @unique // Keycloak Client ID（例: "mcp-proxy-client-abc123"）
  organizationId    String
  instanceId        String   @unique
  name              String
  description       String?
  scopes            String[] @default([])
  isActive          Boolean  @default(true)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  organization Organization          @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  instance     UserMcpServerInstance @relation(fields: [instanceId], references: [id], onDelete: Cascade)

  @@index([organizationId])
  @@index([keycloakClientId])
}
