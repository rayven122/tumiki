/**
 * @namespace Auth
 */

/// @namespace Auth
enum Role {
  /// システム管理者
  SYSTEM_ADMIN
  /// 一般ユーザー
  USER
}

/// @namespace Auth
/// @namespace Chat
model User {
  /// ユーザーID - 主キーとして使用
  id                      String                   @id
  /// ユーザー名
  name                    String?
  /// メールアドレス
  email                   String?                  @unique
  /// メールアドレス検証日時 (Auth.js required)
  emailVerified           DateTime?
  /// プロフィール画像のURL
  image                   String?
  /// ユーザーの権限
  role                    Role                     @default(USER)
  /// セッション管理に移行。新規コードでは使用しないこと。
  /// デフォルト組織のスラッグ
  defaultOrganizationSlug String?
  /// セッション管理に移行。新規コードでは使用しないこと。
  /// デフォルト組織への参照
  defaultOrganization     Organization?            @relation("UserDefaultOrganization", fields: [defaultOrganizationSlug], references: [slug])
  organizations           Organization[]
  members                 OrganizationMember[]
  invitations             OrganizationInvitation[]
  /// Chat関連
  Chat                    Chat[]
  Document                Document[]
  Suggestion              Suggestion[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  /// MCP関連
  mcpServerTemplates McpServerTemplate[]
  mcpServers         McpServer[]         @relation("McpServerCreatedBy")
  mcpConfigs         McpConfig[]
  mcpApiKeys         McpApiKey[]
  mcpOAuthTokens     McpOAuthToken[]

  /// フィードバック
  feedbacks Feedback[]

  /// 通知関連
  notifications          Notification[]
  triggeredNotifications Notification[] @relation("NotificationTriggeredBy")

  /// エージェント関連（作成者として）
  createdAgents Agent[] @relation("AgentCreatedBy")

  /// Slack連携を行った組織
  slackConnectedOrganizations Organization[] @relation("SlackConnectedOrganizations")

  /// Auth.js adapter
  accounts Account[]
  sessions Session[]
}

/// @namespace Auth
/// Auth.js Adapter: OAuth プロバイダー連携情報
model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

/// @namespace Auth
/// Auth.js Adapter: セッション情報
model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

/// @namespace Auth
/// Auth.js Adapter: メール検証トークン
model VerificationToken {
  identifier String
  token      String
  expires    DateTime

  @@unique([identifier, token])
}
