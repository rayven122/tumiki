/**
 * @namespace McpServer
 * 全ユーザが共通して利用するテーブル
 */

/// 接続タイプ
/// @namespace McpServer
enum TransportType {
    /// 標準入出力での通信
    STDIO
    /// Server-Sent Eventsでの通信  
    SSE
}


/// ユーザーカスタムサーバーの可視性
/// @namespace McpServer
enum McpServerVisibility {
    /// 作成者のみ閲覧可能
    PRIVATE
    /// 組織内で共有
    ORGANIZATION
    /// 全ユーザーに公開
    PUBLIC
}

/// MCP サーバー (github や notion などの接続する外部 MCP サーバー)
/// transportType に応じて接続方式を選択
/// @namespace McpServer
model McpServer {
    id               String                @id @default(cuid())
    /// MCP サーバー名
    /// @zod.string.min(1)
    name             String                @unique
    /// アイコンパス
    iconPath         String?
    /// 接続タイプ（stdio, sse）
    transportType    TransportType         @default(STDIO)
    /// STDIO用のコマンド
    command          String?
    /// STDIO用の引数
    args             String[]
    /// SSE接続用のURL
    url              String?
    /// STDIO: 環境変数のキー配列（値はUserMcpServerConfigで管理）
    /// SSE: ヘッダーのキー配列（値はUserMcpServerConfigで管理）
    envVars          String[]
    /// サーバーの種類（公式/ユーザーカスタム）
    serverType       ServerType            @default(OFFICIAL)
    /// ユーザーカスタムサーバーの作成者
    createdBy        String?
    creator          User?                 @relation(fields: [createdBy], references: [id])
    /// ユーザーカスタムサーバーの可視性
    visibility       McpServerVisibility   @default(PRIVATE)
    /// サーバーが公開されているか（レガシー）
    isPublic         Boolean               @default(false)
    tools            Tool[]
    mcpServerConfigs UserMcpServerConfig[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

/// MCP サーバーのツール一覧
/// @namespace McpServer
model Tool {
    id               String                @id @default(cuid())
    /// ツールの名前
    /// @zod.string.min(1)
    name             String
    /// ツールの説明
    description      String
    /// ツールの入力スキーマ（JSON Schema形式）
    inputSchema      Json
    /// ツールを有効にするか
    isEnabled        Boolean               @default(true)
    mcpServerId      String
    mcpServer        McpServer             @relation(fields: [mcpServerId], references: [id], onDelete: Cascade)
    mcpServerConfigs UserMcpServerConfig[]
    /// ToolGroup との関連を表す中間テーブル
    toolGroupTools   UserToolGroupTool[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    /// MCP サーバー内のツールの名前は一意
    @@unique([mcpServerId, name])
}
