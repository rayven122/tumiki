name: ğŸ” Claude Code Review

on:
  pull_request:
    types: [opened, synchronize]

jobs:
  claude-review:
    name: ğŸ“ Code Review
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
      issues: read
      id-token: write

    steps:
      - uses: actions/checkout@v6
        with:
          fetch-depth: 1

      - uses: anthropics/claude-code-action@v1
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}

          # ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆã‚’1ã¤ã«çµ±åˆã—ã€æ›´æ–°æ™‚ã«ä¸Šæ›¸ã
          use_sticky_comment: "true"

          prompt: |
            ## ãƒ¬ãƒ“ãƒ¥ãƒ¼æº–å‚™
            ä»¥ä¸‹ã‚’èª­ã¿è¾¼ã¿ã€è¦ç´„ã‚’æŠŠæ¡ã—ã¦ãã ã•ã„ï¼š
            - `CLAUDE.md`
            - `.claude/rules/typescript.md`
            - `.claude/rules/testing.md`
            - `.claude/rules/frontend.md`

            ## ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Ÿæ–½
            1. è¦ç´„é•åã‚’æœ€å„ªå…ˆã§ãƒã‚§ãƒƒã‚¯
            2. ã‚³ãƒ¼ãƒ‰å“è³ªãƒ»è¨­è¨ˆåŸå‰‡ãƒ»ãƒã‚°ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’ç¢ºèª
            3. å„æŒ‡æ‘˜ã«é‡è¦åº¦ã‚¹ã‚³ã‚¢ï¼ˆ1-10ï¼‰ã‚’ä»˜ä¸
            4. æ”¹å–„ã‚³ãƒ¼ãƒ‰ä¾‹ã‚’æç¤º

          allowed_tools: |
            mcp__github_inline_comment__create_inline_comment
            Bash(gh pr comment:*)
            Bash(gh pr view:*)
            Bash(gh pr diff:*)
            Read

          track_progress: true

          claude_args: |
            --append-system-prompt "æ—¥æœ¬èªã§å›ç­”ã€‚è¦ç´„é•åã¯é‡è¦åº¦8ä»¥ä¸Šã¨ã—ã¦å ±å‘Šã€‚

            ## ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯æ–¹æ³•
            - å…·ä½“çš„ãªå•é¡Œã¯ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆmcp__github_inline_comment__create_inline_commentï¼‰ã‚’ä½¿ç”¨
            - å…¨ä½“çš„ãªè©•ä¾¡ã¯PRã‚³ãƒ¡ãƒ³ãƒˆï¼ˆgh pr commentï¼‰ã‚’ä½¿ç”¨

            ## å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

            ### ğŸ¤– Claude Code Review

            **ç·åˆè©•ä¾¡**: âœ… æ‰¿èªå¯èƒ½ / âš ï¸ æ”¹å–„æ¨å¥¨ / âŒ è¦ä¿®æ­£

            **é‡è¦åº¦åˆ†å¸ƒ**: ğŸ”´ ç·Šæ€¥(8-10): Xä»¶ / ğŸŸ¡ é‡è¦(5-7): Xä»¶ / ğŸŸ¢ è»½å¾®(1-4): Xä»¶

            ### æŒ‡æ‘˜äº‹é …

            **ğŸ”´ [é‡è¦åº¦: X/10] å•é¡Œã®æ¦‚è¦**
            - ãƒ•ã‚¡ã‚¤ãƒ«: path/to/file.ts:è¡Œç•ªå·
            - ç¾åœ¨ã®ã‚³ãƒ¼ãƒ‰: ...
            - æ”¹å–„æ¡ˆ: ...
            - ç†ç”±: ...

            ### âœ¨ è‰¯ã„ç‚¹
            - ...

            ### ğŸ¯ æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
            1. ..."
